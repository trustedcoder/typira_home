# General Rules
- You are an expert software engineer and architect with deep knowledge of Flutter, Dart, Python, and modern backend development.
- Provide concise, accurate, and correct code examples. Avoid conversational filler.
- Focus on clean, readable, and maintainable code.
- Follow "Clean Architecture" principles where applicable.
- When editing code, always output the full file content if the file is small, or use precise search/replace blocks for larger files.
- Commit messages should be semantic (e.g., `feat:`, `fix:`, `chore:`, `refactor:`).

# Flutter & Dart Rules (Path: mobile/)
- **Strong Typing**: Always use strong types. Avoid `dynamic` unless absolutely necessary.
- **Const Correctness**: Use `const` constructors for widgets and value objects whenever possible.
- **Null Safety**: Embrace null safety. Use `?`, `!`, and `late` appropriately, but prefer safe access `?.` and defaults `??` over force unwrapping `!`.
- **Async/Await**: Prefer `async`/`await` over raw `Future` and `.then()`.
- **Widget Structure**: 
  - Break down large widgets into smaller, reusable components.
  - Use `StatelessWidget` by default; use `StatefulWidget` only when maintaining local state is required.
- **State Management**: Make use of Getx only.
- **Imports**: Prefer absolute imports `package:typira/...` over relative imports `../../`.

# Python Rules (Path: backend_api/)
- **PEP 8**: Follow standard PEP 8 style guidelines.
- **Type Hinting**: Use Python type hints (`typing` module) for all function arguments and return values.
- **Docstrings**: Include docstrings for all public modules, classes, and methods (Google or NumPy style).
- **Error Handling**: Use explicit `try-except` blocks. Avoid bare `except:`.
- **Virtual Env**: Assume a virtual environment is active.
- **Modern Python**: Use modern Python 3.10+ features (e.g., match statements, union types `|`).

# Hybrid Architecture Policy (Keyboard)
- **Native for Core Input**: The keyboard's core rendering, input handling (QWERTY, Symbols, Emoji board), and performance-critical gestures (Spacebar trackpad) MUST remain native (Swift for iOS, Kotlin for Android). This is to respect strict memory limits and ensure zero-latency typing.
- **Flutter for Intelligence & UI**: All "Intelligence" features (AI Memory management, Dashboard, Goal tracking, Settings, Backend connectivity) MUST be built in Flutter.
- **Bridging**: Use `MethodChannel` (Android) and `FlutterMethodChannel` (iOS) to communicate between the native keyboard extension/service and the Flutter engine.
- **Memory Conservation**: Be extremely cautious with resource usage in the Native Keyboard layer. Avoid loading large assets or background processes that could exceed iOS keyboard memory limits.

# Project Structure specific
- `backend_api/`: Python backend code.
- `mobile//typira/`: Main project directory.
- `mobile//typira/android/`: Native Android keyboard implementation (InputMethodService).
- `mobile//typira/ios/`: Native iOS keyboard implementation (Keyboard Extension).
- `mobile//typira/lib/`: Flutter code for Dashboard, Memory, and AI Logic.
