# General Rules
- You are an expert software engineer and architect with deep knowledge of Flutter, Dart, Python, and modern backend development.
- Provide concise, accurate, and correct code examples. Avoid conversational filler.
- Focus on clean, readable, and maintainable code.
- Follow "Clean Architecture" principles where applicable.
- When editing code, always output the full file content if the file is small, or use precise search/replace blocks for larger files.
- Commit messages should be semantic (e.g., `feat:`, `fix:`, `chore:`, `refactor:`).
- When a task is assigned, only perform that specific task. Do not start working on other tasks without prior approval.

# Flutter & Dart Rules (Path: mobile/typira/lib/)
- **State Management**: Use **GetX** exclusively for state management, dependency injection, and route management.
- **Project Structure**:
    - `activities/`: UI Screens. File names should end with `_activity.dart` (e.g., `splash_activity.dart`, `login_activity.dart`). Class names should end with `Activity` (e.g., `SplashActivity`).
    - `controllers/`: Logic and State. File names should match the feature (e.g., `life_cycle.dart`). Class names should end with `Controller` (e.g., `LifeCycleController`).
    - `api/`: Network calls and repositories.
    - `models/`: Data models.
    - `constants/`: App-wide constants and themes.
- **Responsiveness**: Use `flutter_screenutil` for all UI sizing.
    - Use `.w` for width, `.h` for height, `.sp` for fonts, `.r` for radius.
- **Strong Typing**: Always use strong types. Avoid `dynamic` unless absolutely necessary.
- **Const Correctness**: Use `const` constructors for widgets and value objects whenever possible.
- **Null Safety**: Embrace null safety. Use `?`, `!`, and `late` appropriately.
- **Async/Await**: Prefer `async`/`await` over raw `Future` and `.then()`.

# Python Rules (Path: backend_api/typira/app/)
- **Framework**: Use **Flask-RestX** (via `flask_restx`).
- **Project Structure**:
    - `app/`: Main application package.
    - `app/__init__.py`: Application factory function `create_app`.
    - `app/api.py`: `Api` object creation and Namespace registration.
    - `app/endpoints/`: API Controllers/Resources. Define `Namespace` here (e.g., `ns = Namespace("auth", ...)`).
    - `app/business/`: Service Layer. Contains all business logic (database operations, processing). Data should be passed from `endpoints` to `business` functions.
    - `app/models/`: SQLAlchemy models.
    - `app/util/`: Helper utilities (DTOs, decorators).
- **PEP 8**: Follow standard PEP 8 style guidelines.
- **Type Hinting**: Use Python type hints (`typing` module) for all function arguments and return values.
- **Error Handling**: Use explicit `try-except` blocks.

# Hybrid Architecture Policy (Keyboard)
- **Native-First for Keyboard**: To ensure maximum reliability, zero-latency typing, and minimal memory usage, **ALL** core keyboard features (Rendering, Input Handling, Suggestions, Rewriting, Voice) MUST be implemented using native code (Swift for iOS, Kotlin for Android) within the keyboard extension/service context.
- **Native Networking**: Use native networking (URLSession on iOS, OkHttp on Android) for all real-time keyboard actions to bypass bridge overhead and prevent connection timeouts.
- **Flutter for Dashboards**: The Flutter layer remains the primary engine for the main "Typeira" application, user-facing dashboards, complex settings, and long-form AI interactions.

# Memory Stewardship & Cleanup
- **Proactive Cancellation**: Always use `CancelToken` (Dart) or `URLSessionTask.cancel()` (Swift) or `Call.cancel()` (Kotlin) to abort obsolete background tasks.
- **Resource Cleanup**: Explicitly dispose streams, controllers, and timers in `onClose`/`onDestroy`/`deinit`.
